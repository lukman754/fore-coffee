<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Fore Coffe Disc 50%</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.0/qrcode.min.js"></script>
    <script
      src="https://kit.fontawesome.com/8c8ccf764d.js"
      crossorigin="anonymous"
    ></script>
    <script src="product.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="icon.png" />
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              coffee: {
                100: "#F5EBE0",
                200: "#E6D2B5",
                300: "#D4B996",
                400: "#C09A6B",
                500: "#8B5A2B",
                600: "#704012",
                700: "#5C3811",
                800: "#4A2E0D",
                900: "#3B240A",
              },
            },
          },
        },
      };
    </script>
  </head>

  <body class="bg-gray-50 font-sans">
    <div class="container mx-auto max-w-3xl shadow-lg bg-white">
      <!-- Navbar -->
      <nav class="sticky top-0 z-50 bg-white shadow-md" id="top">
        <div class="container mx-auto px-4 py-3">
          <a class="navbar-brand flex items-center" href="#">
            <img
              src="icon.png"
              alt="Logo"
              width="30"
              height="30"
              class="rounded mr-2"
            />
            <span class="text-coffee-600 font-bold text-lg"
              >Fore Coffe Disc 50%</span
            >
          </a>
        </div>
      </nav>

      <!-- Terms and Conditions -->
      <div class="bg-coffee-100 border-b border-coffee-200 py-3">
        <div class="container mx-auto px-4">
          <div class="space-y-2">
            <div>
              <strong class="text-coffee-700">Syarat & Ketentuan:</strong>
              <ul
                class="mb-0 text-xs leading-relaxed pl-5 text-coffee-800 mt-1"
              >
                <li>Promo hanya berlaku untuk Semua Ukuran</li>
                <li>
                  Promo hanya berlaku untuk pembelian Pickup (Tidak bisa
                  Delivery)
                </li>
                <li>Promo hanya berlaku untuk menu yang ada di katalog</li>
                <li>Promo berlaku di semua outlet Fore Coffee</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- Header with search and filters -->
      <header
        class="sticky top-12 z-40 bg-white border-b border-coffee-200 px-4 py-3"
      >
        <form class="mb-3" role="search">
          <input
            id="search"
            class="w-full px-4 py-2 border border-coffee-300 rounded-full focus:outline-none focus:ring-2 focus:ring-coffee-400"
            type="search"
            placeholder="Search"
            aria-label="Search"
          />
        </form>

        <!-- Tags -->
        <div class="tags flex flex-wrap gap-2 mb-3">
          <div
            class="tag bg-green-100 text-green-800 rounded-full px-3 py-1 text-xs font-medium matcha"
          >
            Matcha
          </div>
          <div
            class="tag bg-amber-100 text-amber-800 rounded-full px-3 py-1 text-xs font-medium choco"
          >
            Choco
          </div>
          <div
            class="tag bg-yellow-100 text-yellow-800 rounded-full px-3 py-1 text-xs font-medium aren"
          >
            Aren
          </div>
          <div
            class="tag bg-coffee-100 text-coffee-800 rounded-full px-3 py-1 text-xs font-medium latte"
          >
            Latte
          </div>
          <div
            class="tag bg-blue-100 text-blue-800 rounded-full px-3 py-1 text-xs font-medium americano"
          >
            Americano
          </div>
          <div
            class="tag bg-orange-100 text-orange-800 rounded-full px-3 py-1 text-xs font-medium oat"
          >
            Oat
          </div>
        </div>

        <!-- Category filters -->
        <div
          class="filters categories-wrapper flex overflow-x-auto py-2 no-scrollbar"
        >
          <button
            class="bg-coffee-600 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category active hover:bg-coffee-700 transition-colors"
            data-filter="*"
          >
            <span>‚≠ê SEMUA</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".AmericanoSeries"
          >
            <span>ü•É Americano Series</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".Coffee"
          >
            <span>‚òï Coffee</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".NonCoffee"
          >
            <span>üçµ Non Coffee</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".ForeDeli"
          >
            <span>ü•™ Fore Deli</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".ForeJunior"
          >
            <span>ü•§ Fore Junior</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".ForeSignature"
          >
            <span>‚òï Fore Signature</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".IceBlended"
          >
            <span>üßã Ice Blended</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".Refresher"
          >
            <span>üçë Refresher</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".Tea"
          >
            <span>üçµ Tea</span>
          </button>
          <button
            class="bg-gray-700 text-white rounded-full px-4 py-1 mr-2 text-sm whitespace-nowrap category hover:bg-gray-800 transition-colors"
            data-filter=".FOREveryone1L"
          >
            <span>üç∂ FOREveryone 1L</span>
          </button>
        </div>

        <!-- Cart shortcut and back to top -->
        <a
          href="#cart"
          class="cart-bubble fixed bottom-20 right-4 bg-coffee-600 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:bg-coffee-700 transition-colors"
        >
          <i class="fas fa-shopping-cart"></i>
          <span
            id="cart-count"
            class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center"
            >0</span
          >
        </a>
        <a
          href="#product-list"
          class="arrow-up fixed bottom-4 right-4 bg-coffee-600 text-white rounded-full w-12 h-12 flex items-center justify-center shadow-lg hover:bg-coffee-700 transition-colors"
        >
          <i class="fas fa-angle-up"></i>
        </a>
      </header>

      <!-- Product List -->
      <main class="bg-gray-50 min-h-screen">
        <div class="product-list p-4" id="product-list">
          <div
            class="grid grid-cols-1 sm:grid-cols-2 gap-4"
            id="category-container"
          >
            <!-- Products will be displayed here -->
          </div>
          <div class="size-options hidden" data-product-id="${product.id}">
            <!-- Size options will be displayed here -->
          </div>
        </div>
      </main>

      <!-- Cart -->
      <aside class="container mx-auto max-w-3xl">
        <div
          class="cart bg-coffee-800 text-white rounded-t-lg p-4 mt-6 shadow-lg"
        >
          <div class="grid grid-cols-1 md:grid-cols-12 gap-4">
            <div class="md:col-span-9">
              <h4 class="text-xl font-bold mb-3 text-coffee-100">Keranjang</h4>
              <div class="bg-coffee-700/50 p-3 rounded-lg mb-3" id="cart"></div>
              <p class="text-right text-coffee-200" id="admin-fee"></p>

              <p
                class="bg-coffee-600 p-3 rounded-lg w-full mt-2 flex justify-between font-medium"
              >
                <span>Total:</span>
                <span id="total">Rp0</span>
              </p>
            </div>

            <div class="md:col-span-3">
              <h6 class="text-sm font-medium mb-2 text-coffee-100">
                Scan QRIS dibawah untuk pembayaran
              </h6>
              <div class="bg-white rounded-lg p-2 w-full" id="qrcode">QRIS</div>
            </div>
          </div>

          <!-- Hidden inputs -->
          <div class="hidden">
            <div class="form-group">
              <label for="nominalInput">Nominal Pembayaran</label>
              <input
                type="number"
                id="nominalInput"
                placeholder="Masukkan nominal pembayaran"
                min="1"
              />
            </div>
            <div class="form-group">
              <label for="qrisInput">QRIS Static Code</label>
              <input
                type="text"
                id="qrisInput"
                value="00020101021126690021ID.CO.BANKMANDIRI.WWW01189360000801178300070211711783000730303UKE51440014ID.CO.QRIS.WWW0215ID10232654103820303UKE5204274153033605802ID5908LM Store6015Tangerang (Kab)61051582062070703A0163040C26"
              />
            </div>
            <div class="button-container">
              <button onclick="generateQRIS()">Generate QRIS</button>
            </div>
          </div>

          <!-- Order form -->
          <form id="order-form" class="mt-4">
            <input
              type="text"
              class="w-full p-2 text-black rounded-lg border border-coffee-300 mb-2 focus:outline-none focus:ring-2 focus:ring-coffee-500"
              placeholder="Nama"
              id="name"
              required
            />
            <input
              type="text"
              class="w-full p-2 text-black rounded-lg border border-coffee-300 mb-3 focus:outline-none focus:ring-2 focus:ring-coffee-500"
              placeholder="Lokasi Fore Coffee"
              id="location"
              required
            />
            <button
              type="submit"
              class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-full transition-colors w-full"
            >
              Pesan Sekarang
            </button>
          </form>
        </div>
      </aside>

      <!-- Footer -->
      <footer class="bg-coffee-900 text-coffee-100 py-4 text-center">
        <p class="text-base">LM Store</p>
      </footer>
    </div>

    <!-- Add FontAwesome -->
    <script
      src="https://kit.fontawesome.com/a076d05399.js"
      crossorigin="anonymous"
    ></script>

    <style>
      /* Hide scrollbar for Chrome, Safari and Opera */
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }

      /* Hide scrollbar for IE, Edge and Firefox */
      .no-scrollbar {
        -ms-overflow-style: none; /* IE and Edge */
        scrollbar-width: none; /* Firefox */
      }
    </style>
    <script src="script.js"></script>
    <script>
      // Function to update input value and generate QR whenever total changes
      function syncTotalAndGenerateQR() {
        const totalElement = document.getElementById("total");
        const inputElement = document.getElementById("nominalInput");

        // Create a MutationObserver to watch for changes in the total element
        const observer = new MutationObserver(function (mutations) {
          mutations.forEach(function (mutation) {
            // Extract number from total (remove 'Rp' and any non-digit characters)
            const totalValue = mutation.target.textContent
              .replace("Rp", "")
              .replace(/\D/g, "");
            // Update input value
            inputElement.value = totalValue;
            // Generate QR code automatically
            if (totalValue > 0) {
              generateQRIS();
            }
          });
        });

        // Configuration for the observer (watch for changes in text content)
        const config = { characterData: true, childList: true, subtree: true };

        // Start observing the total element
        observer.observe(totalElement, config);

        // Also set initial value when page loads
        const initialValue = totalElement.textContent
          .replace("Rp", "")
          .replace(/\D/g, "");
        inputElement.value = initialValue;
        if (initialValue > 0) {
          generateQRIS();
        }
      }

      function pad(number) {
        return number < 10 ? "0" + number : number.toString();
      }

      function toCRC16(input) {
        let crc = 0xffff;
        for (let i = 0; i < input.length; i++) {
          crc ^= input.charCodeAt(i) << 8;
          for (let j = 0; j < 8; j++) {
            crc = crc & 0x8000 ? (crc << 1) ^ 0x1021 : crc << 1;
          }
        }
        let hex = (crc & 0xffff).toString(16).toUpperCase();
        return hex.length === 3 ? "0" + hex : hex;
      }

      function makeString(qris, { nominal } = {}) {
        if (!qris) throw new Error('The parameter "qris" is required.');
        if (!nominal) throw new Error('The parameter "nominal" is required.');

        let qrisModified = qris.slice(0, -4).replace("010211", "010212");
        let qrisParts = qrisModified.split("5802ID");

        let amount = "54" + pad(nominal.toString().length) + nominal;
        amount += "5802ID";

        let output = qrisParts[0].trim() + amount + qrisParts[1].trim();
        output += toCRC16(output);

        return output;
      }

      function generateQRIS() {
        const qrisInput = document.getElementById("qrisInput").value.trim();
        const nominalInput = document
          .getElementById("nominalInput")
          .value.trim();

        if (
          !qrisInput ||
          !nominalInput ||
          isNaN(nominalInput) ||
          Number(nominalInput) <= 0
        ) {
          console.log("Waiting for valid total and QRIS input");
          return;
        }

        const qrisDinamis = makeString(qrisInput, { nominal: nominalInput });
        console.log("QRIS Dinamis:", qrisDinamis);

        const qrcodeElement = document.getElementById("qrcode");
        qrcodeElement.innerHTML = ""; // Clear previous QR Code
        QRCode.toCanvas(
          qrisDinamis,
          { margin: 2 }, // Tidak menentukan width di sini
          function (err, canvas) {
            if (err) {
              console.error("QR Code Error:", err);
              return;
            }

            // Mengatur lebar canvas menjadi 100%
            canvas.style.width = "100%";
            canvas.style.height = "auto"; // Untuk menjaga aspek rasio

            // Menambahkan canvas ke elemen target
            qrcodeElement.appendChild(canvas);
          }
        );
      }

      // Initialize when DOM is fully loaded
      document.addEventListener("DOMContentLoaded", syncTotalAndGenerateQR);
    </script>
  </body>
</html>
